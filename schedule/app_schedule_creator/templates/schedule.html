{% extends "base.html" %} {% block title %} Schedule Choices {% endblock %} {% block css %}none.css{% endblock %} 
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<h1>Schedule Options</h1>
<button id="clear">clear</button>
<button id="next">next</button>
<button id="prev">prev</button>

<script>
    calendars = [];
    num = 0;
    function updateCalendar(direction) {
        if (direction == "next") {
            num = num + 1;
        } else if (direction == "prev") {
            num = num - 1;
        }

        if (num < 0) {
            num = 0;
        } else if (num >= calendars.length) {
            num = calendars.length - 1;
        }

        console.log(num)
        let calendar = calendars[num];
        calendar.render();
    }

    function clearCalendar() {
        var calendarEl = document.getElementById("calendar");
        var calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth,timeGridWeek,timeGridDay",
            },
            initialView: "timeGridWeek",
        });
        calendar.render();
    }

    // load and save all valid calendars to `calendars`
    document.addEventListener("DOMContentLoaded", function () {
        var calendarEl;
        var calendar;
        var daysOfWeek = [];

        {% for valid_option in valid_course_options %}
        
        calendarEl = document.getElementById("calendar");
        calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth,timeGridWeek,timeGridDay",
            },
            initialView: "timeGridWeek",
        });
        daysOfWeek = [];

        {% for course in valid_option %}{% for section in course %}
        console.log('{{section.course_start_time|time:"H:i:s"}}',"{{section.course_start_time}}")

        for (let i = 0; i < '{{section.course_days}}'.length; i++) {
            if ('{{section.course_days}}'[i] == 'M') {
                daysOfWeek.push('1');
            } else if ('{{section.course_days}}'[i] == 'T') {
                daysOfWeek.push('2');
            } else if ('{{section.course_days}}'[i] == 'W') {
                daysOfWeek.push('3');
            } else if ('{{section.course_days}}'[i] == 'R') {
                daysOfWeek.push('4');
            } else if ('{{section.course_days}}'[i] == 'F') {
                daysOfWeek.push('5');
            }
        }
        
        calendar.addEvent({
            title: "{{section.course_code}} {{section.course_type}}",
            startTime: '{{section.course_start_time|time:"H:i:s"}}',
            endTime: '{{section.course_end_time|time:"H:i:s"}}',
            daysOfWeek: daysOfWeek,
            startRecur: '{{section.course_start_date|date:"Y-m-d"}}',
            endRecur: '{{section.course_end_date|date:"Y-m-d"}}',
            {% if "LEC" not in section.course_type %}
            color: 'green',
            {% endif %}
        });
        daysOfWeek = []
        
        

        {% endfor %}{% endfor %}
        calendars.push(calendar);
        {% endfor %}
        calendar.render();
        
        console.log(calendars)
    });

    document.getElementById("clear").addEventListener("click", function () {
        clearCalendar();
    });

    document.getElementById("next").addEventListener("click", function () {
        updateCalendar("next");
    });

    document.getElementById("prev").addEventListener("click", function () {
        updateCalendar("prev");
    });
</script>



<div id="calendar"></div>

{% endblock %}
